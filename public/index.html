<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
 
  <head>
    <title>Account Manager</title>
    <link rel="stylesheet" type="text/css" href="javascripts/ext-4.0/resources/css/ext-all.css">
    
	 <script type="text/javascript">
		// global object
		var localStorage;
		
		function init_store() {
		  // load persistent store after the DOM has loaded
		  localStorage = new Persist.Store('pocOffline');
		}
		
		// isonline ?
		var isOnline=navigator.onLine;
		function init_connection_status() {
			update_connection_status();
			window.setInterval(function() {
				if (isOnline != navigator.onLine) {
					isOnline = navigator.onLine;
					if(isOnline) {
						var usersStore = Ext.data.StoreManager.getByKey('Users');
						usersStore.sync();
						
					}
				}
				update_connection_status();
			}, 1000);
		}
		
		function update_connection_status() {
			connectionStatus = document.getElementById("connectionStatus")
			if(connectionStatus) {
				text=connectionStatus.getElementsByClassName("x-btn-inner")[0];
				if(text) {
					if (isOnline) {
						text.innerHTML = "Online !"
						removeClass(text, "offline");
						addClass(text, "online");
					} else {
						text.innerHTML = "Offline =("
						removeClass(text, "online");
						addClass(text, "offline");
					}
				}
				
			}
		}
		
		function hasClass(ele,cls) {
			return ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));
		}

		function addClass(ele,cls) {
			if (!this.hasClass(ele,cls)) ele.className += " "+cls;
		}

		function removeClass(ele,cls) {
			if (hasClass(ele,cls)) {
				var reg = new RegExp('(\\s|^)'+cls+'(\\s|$)');
				ele.className=ele.className.replace(reg,' ');
			}
		}

		
	 </script>
	 <style>
		#connectionStatus span.x-btn-inner  { color:black; }
		#connectionStatus span.x-btn-inner.online { color:green; }
		#connectionStatus span.x-btn-inner.offline { color:red; }
	 </style>
    <script type="text/javascript" src="javascripts/persist-min.js"></script>
    <script type="text/javascript" src="javascripts/ext-4.0/ext-debug.js"></script>
    <script type="text/javascript" src="javascripts/app.js"></script>
	 
  </head>
  <body onload="init_store();init_connection_status()"></body>
</html>